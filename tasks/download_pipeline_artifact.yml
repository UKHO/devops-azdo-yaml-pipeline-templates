# Azure DevOps Task: DownloadPipelineArtifact@2
#
# Purpose:
#   Provides a reusable, standardized wrapper for downloading pipeline artifacts in Azure DevOps pipelines.
#   Supports downloading a specific artifact or all artifacts from the current pipeline run, with configurable target path and file patterns.
#
# Parameters:
#   - ArtifactName (string, optional): Name of the artifact to download. Leave empty to download all artifacts.
#   - DownloadAllArtifacts (boolean, optional): If true, downloads all artifacts from the pipeline run. Default: false
#   - ItemPattern (string, optional): File matching pattern (newline-delimited). Default: '**'
#   - TargetPath (string, optional): Destination directory for downloaded artifacts. Default: $(Pipeline.Workspace)
#
# Example Usage:
#   - template: tasks/download_pipeline_artifact.yml
#     parameters:
#       ArtifactName: 'WebApp'
#       TargetPath: '$(Build.ArtifactStagingDirectory)/WebApp'
#
#   - template: tasks/download_pipeline_artifact.yml
#     parameters:
#       DownloadAllArtifacts: true
#       TargetPath: '$(Build.ArtifactStagingDirectory)/All'
#
# Notes:
#   - Only supports downloading from the current pipeline run (buildType: 'current').
#   - Does not implement downloading from specific builds or external pipelines.

parameters:
  - name: ArtifactName
    type: string
    default: ''
    displayName: 'Artifact name (leave empty to download all artifacts)'

  - name: DownloadAllArtifacts
    type: boolean
    default: false
    displayName: 'Whether this task downloads all artifacts associated with the pipeline run'

  - name: ItemPattern
    type: string
    default: '**'
    displayName: 'File matching patterns (newline-delimited)'

  - name: TargetPath
    type: string
    default: '$(Pipeline.Workspace)'
    displayName: 'Destination directory path'

steps:
  - task: DownloadPipelineArtifact@2
    ${{ if and(eq(parameters.DownloadAllArtifacts, 'false'), ne(parameters.ArtifactName, '')) }}:
      displayName: 'Download artifact: ${{ parameters.ArtifactName }}'
    ${{ else }}:
      displatName: 'Download all artifacts'
    inputs:
      buildType: 'current'
      ${{ if and(eq(parameters.DownloadAllArtifacts, 'false'), ne(parameters.ArtifactName, '')) }}:
        artifactName: '${{ parameters.ArtifactName }}'
      itemPattern: '${{ parameters.ItemPattern }}'
      targetPath: '${{ parameters.TargetPath }}'
